<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Hotel CMS! | </title>

    <!-- Bootstrap -->
    <link href="/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="/iCheck/skins/flat/green.css" rel="stylesheet">	
    <!-- bootstrap-progressbar -->
    <link href="/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
    <!-- JQVMap -->
    <link href="/jqvmap/dist/jqvmap.min.css" rel="stylesheet"/>
    <!-- bootstrap-daterangepicker -->
    <link href="/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="/css/custom.min.css" rel="stylesheet">
  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        
        <% include ../sidebar %>

        <!-- top navigation -->
        <% include ../nav-top %>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <div id="mainhold">
            <form onsubmit="return dobooking()" method="post">
              <table cellpadding="5">
                <tr>
                  <td>Customer Name </td><td><input type="text" name="cname" value="utsav" required></td>
                <tr>
                  <td>Contact Number </td><td><input type="number" name="contact" maxlength="10"  required>  </td>
                </tr>
                <tr>
                  <td>Email </td><td><input type="email" name="email"></td>
                </tr>
              </table>
              
              Booking Date&nbsp;<input type="date" id="bookdate" name="bookdate" readonly><br><br> 
              Rooms&nbsp;<input type="number" min="1" max="5000" id="norooms" name="norooms" required >&emsp;&emsp; 
              Check in Date&nbsp;<input type="date" id="chkindate" name="chkindate" onchange="selcheckin(this.value)">&emsp;&emsp;
              Check out Date&nbsp;<input type="date" id="chkoutdate" name="chkoutdate" onchange="showavail()">&emsp;&emsp;
              <input type="button" name="asd" onclick="showavail()" value="Get Availability">
              <br><br>
              
              <span id="nightcount"></span><br><br>
              <div id="catagoryhold">
                
              </div>
              <div id="bookinghold">
                
              </div>

              <span id="quotehold"></span>
              <div id="bookbutton">

              </div>
            </form>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
          <div class="pull-right">
    
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="/nprogress/nprogress.js"></script>
    <!-- Chart.js -->
    <script src="/Chart.js/dist/Chart.min.js"></script>
    <!-- gauge.js -->
    <script src="/gauge.js/dist/gauge.min.js"></script>
    <!-- bootstrap-progressbar -->
    <script src="/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <!-- iCheck -->
    <script src="/iCheck/icheck.min.js"></script>
    <!-- Skycons -->
    <script src="/skycons/skycons.js"></script>
    <!-- Flot -->
    <script src="/Flot/jquery.flot.js"></script>
    <script src="/Flot/jquery.flot.pie.js"></script>
    <script src="/Flot/jquery.flot.time.js"></script>
    <script src="/Flot/jquery.flot.stack.js"></script>
    <script src="/Flot/jquery.flot.resize.js"></script>
    <!-- Flot plugins -->
    <script src="/flot.orderbars/js/jquery.flot.orderBars.js"></script>
    <script src="/flot-spline/js/jquery.flot.spline.min.js"></script>
    <script src="/flot.curvedlines/curvedLines.js"></script>
    <!-- DateJS -->
    <script src="/DateJS/build/date.js"></script>
    <!-- JQVMap -->
    <script src="/jqvmap/dist/jquery.vmap.js"></script>
    <script src="/jqvmap/dist/maps/jquery.vmap.world.js"></script>
    <script src="/jqvmap/examples/js/jquery.vmap.sampledata.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="/moment/min/moment.min.js"></script>
    <script src="/bootstrap-daterangepicker/daterangepicker.js"></script>

    <!-- Custom Theme Scripts -->
    <script src="/js/custom.min.js"></script>
    <!-- Custom booking Scripts -->
    <script src="/booking/book.js"></script>

    <script type="text/javascript">
        $(document).ready(function(){
            var out = null;

            $.ajax({

                type: "post",
                url: "/getdate",
                dataType: 'json',
                data: JSON.stringify({
                    "any": "any"
                }),
                contentType: 'application/json',
                success: function(data) {
                    out = data;


                //conversion of received date
                var today = new Date(out);
                var dd = today.getDate();
                var mm = today.getMonth() + 1;
                var yyyy = today.getFullYear();
                if (dd < 10) {
                    dd = '0' + dd
                }
                if (mm < 10) {
                    mm = '0' + mm
                }

                today = yyyy + '-' + mm + '-' + dd;

                document.getElementById("chkindate").setAttribute("min", today);
                document.getElementById("chkoutdate").setAttribute("min", today);
                document.getElementById('bookdate').value = today;
                }
            });
        });

        function selcheckin(valu) { //set checkout min value to the checkin
            var setcheckout = new Date(valu);
            setcheckout.setDate(setcheckout.getDate() + 1);
            var dd = setcheckout.getDate();
            var mm = setcheckout.getMonth() + 1; //January is 0!
            var yyyy = setcheckout.getFullYear();
            if (dd < 10) {
                dd = '0' + dd
            }
            if (mm < 10) {
                mm = '0' + mm
            }

            setcheckout = yyyy + '-' + mm + '-' + dd;

            document.getElementById("chkoutdate").setAttribute("min", setcheckout);
        }
      plannamelist=null;
        ebed=0;

        planprices=null;
        jsarr=[];

        function showavail() {
            var room = document.getElementById('norooms').value;
            if(room.localeCompare("")==0  || room==null || room<1){
              document.getElementById('norooms').focus()
              return
            }
            var chkin = document.getElementById('chkindate').value;
            var chkout = document.getElementById('chkoutdate').value;
            var chi = new Date(chkin);
            var cho = new Date(chkout);
            asd = (cho.getDate() - chi.getDate()).toString() + " Night(s)";
            document.getElementById('nightcount').innerHTML = asd;
            // request getavail on nodejs
            $.ajax({

                type: "post",
                url: "/getavail",
                dataType: 'json',
                data: JSON.stringify({
                    "checkindate": chkin,
                    "checkoutdate": chkout,
                    "norooms": room
                }),
                contentType: 'application/json',
                success: function(data) {
                 plannamelist=data.plans.plannames;
                   planprices=data.plans.planprices;
                  ebed=data.ebedprice;

                  jsarr=data.jsa;
                
                  $('#catagoryhold').html('');
                    
          $('#catagoryhold').append('<table border="1" cellpadding="5" id="mytab">');
                   
                   $('#mytab').append('<tr><th>Category Name</th><th>Room Price</th><th>Total Price</th><th>Select</th></tr>')
              

                    for (var i = 0; i < data.jsa.length; i++) {

                        va = data.jsa[i];

          
                         $('#mytab').append('<tr><td>'+va.catagory+'</td><td>'+va.roomprice+'</td><td>'+va.price+'</td><td><input type="radio" name="selection" onchange="openbooking(this.value)" value="'+va.catagory+'"</td></tr>')
                        

                    }


                }
            });

        }
    </script>
	
  </body>
</html>
